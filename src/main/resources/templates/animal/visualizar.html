<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<style>
h2 {
	color: red
}

.layout-content span {
	color: indigo
}

.generico {
	margin-top: 15px
}

.separador {
	margin: 15px 0
}

.historico-novo {
	background-color: #3ffc7e;
}

.historico-editado {
	background-color: yellow;
}

.historico-editado-consulta {
	background-color: gray;
}

.historico-nova-consulta {
	background-color: blue;
}

.nova-internacao {
	background-color: orange;
}

.edit-internacao {
	background-color: brown;
}

.edit-aplicacao {
	background-color: tomato;
}

.nova-aplicacao {
	background-color: beige;
}

.consulta {
	width: 100%;
	background-color: green;
	color: white;
	margin-top: 20px
}

#mensagem {
	display: none;
	width: 100%;
	background-color: indigo;
	padding: 20px;
	margin-top: 2%
}

#mensagem span {
	color: white;
	font-weight: bold;
}

.historico-wraper {
	height: 600px;
	background-color: pink;
	overflow: auto;
}
/* width */
#scrollbar::-webkit-scrollbar {
	width: 15px;
}

/* fundo*/
#scrollbar::-webkit-scrollbar-track {
	background: #f1f1f1;
}

/* Handle */
#scrollbar::-webkit-scrollbar-thumb {
	background: #46A049;
}

/* Handle on hover */
#scrollbar::-webkit-scrollbar-thumb:hover {
	background: #555;
}

.is-invalid {
	border: 1px solid red;
	!
	important
}

.caracteristicas {
	display: inline width: 10%;
}

.castrado, .bravo {
	padding: 10px;
	margin-left: 2%;
	display: inline;
	float: left;
}

.castrado {
	background-color: orange;
	color: white
}

.bravo {
	background-color: blue;
}

#wrapper-caracteristicas {
	display: block;
	margin-top: 2%;
	margin-bottom: 2%;
	float: left
}

#wrapper-caracteristicas:first-child {
	margin-left: 2%
}

#wrapper-caracteristicas span {
	color: white;
}

.maneira {
	background-color: indigo
}
</style>
</head>
<body>

	<section class="layout-content" layout:fragment="corpo">

		<div th:replace="fragments/alert :: alerta-sucesso"></div>
		<h2 th:text="${animal.nome}"></h2>
		<div th:if="${animal.foto == null}">
			<img alt="" th:src="@{/image/animal_default.jpg}"
				style="width: 200px; height: auto">
		</div>
		<div th:if="${animal.foto!= null && animal.foto.fileName != null}">
			<img alt="" th:src="@{${'/uploads/' + animal.foto.fileName}}"
				style="width: 200px; height: auto">
		</div>
		<div th:if="${animal.status != null}">
			<span th:text="${animal.status}"></span>
		</div>
		<span th:text="${animal.especie.nome}"></span> <span
			th:text="${#temporals.format(animal.dataNascimento, 'dd/MM/yyyy')}"></span>

		<span th:text="${animal.cliente.nome}"></span> <span
			th:text="${animal.cliente.email}"></span>

		<div th:if="${animal.caracteristicas != null}">
			<div id="wrapper-caracteristicas">
				<div th:each="c: ${animal.caracteristicas}">
					<div th:switch="${c}">
						<div th:case="'Castrado'">
							<span th:class='castrado' th:text="${c}"></span>
						</div>
						<div th:case="'Bravo'" class="caracteristicas">
							<span th:class='bravo' th:text="${c}"></span>
						</div>
					</div>

				</div>
			</div>
		</div>
		<section>
			<div class="tabs tabs-style-flip">
				<nav>
					<ul>
						<li><a href="#section-flip-1" class="fas fa-file-medical-alt"><span>Histórico</span></a></li>
						<li><a href="#section-flip-2" class="fas fa-notes-medical"
							style="color: purple"><span>Consultas</span></a></li>

						<li><a href="#section-flip-3"><span>Internações</span></a></li>
						<li><a href="#section-flip-4"><span>Vacinas</span></a></li>

					</ul>
				</nav>
				<div class="content-wrap">

					<section id="section-flip-1">

						<p>

							<button class="btn btn-primary" type="button"
								data-toggle="collapse" data-target="#collapseTipo"
								aria-controls="collapseTipo">Tipos</button>
							<button class="btn btn-primary" type="button"
								data-toggle="collapse" data-target="#collapseData"
								aria-controls="collapseData">Datas</button>
							<a class="btn btn-danger"
								th:href="@{/pacientes/download/historico/paciente/{id} (id=${animal.id})}"
								role="button"><i class="fas fa-download"></i></a>



						</p>
						<div class="row">
							<div class="col">
								<div class="collapse" id="collapseData">
									<nav class="navbar navbar-light bg-light">
										<form class="form-inline">
											<input class="form-control mr-sm-2" type="date"
												aria-label="Search" th:name="teste" id="data-busca" />
										</form>
										<button id="reset"
											class="btn btn-outline-success my-2 my-sm-0">Resetar</button>
									</nav>

								</div>
							</div>
						</div>
						<div class="row">
							<div class="col">
								<div class="collapse" id="collapseTipo">

									<nav class="navbar navbar-light bg-light">
										<form>
											<select class="form-control mr-sm-2" th:name="tipo"
												aria-label="Search" id="tipo">
												<option value="">Mostrar Todos</option>
												<option value="Dados">Cadastro do Paciente</option>
												<option value="Mudar dados">Edição dos dados do
													paciente</option>
												<option value="Nova consulta">Cadastro de novas
													consultas</option>
												<option value="Alteração de consulta">Edição dos
													dados de consultas</option>
												<option value="Nova internação">Cadastro de novas
													internações</option>
												<option value="Alteração de internação">Edição dos
													dados de internações</option>
												<option value="Nova aplicacao">Cadastro de novas
													imunizações</option>
												<option value="Edicao de aplicacao">Edição de dados
													de imunizações</option>
											</select>
										</form>
									</nav>

								</div>
							</div>
						</div>

						<div class="historico-wraper" id="scrollbar">
							<div id="mensagem">
								<span>Nenhum registro encontrado =/</span>
							</div>
							<div id="busca-estilo"></div>
							<div class="listagem-historico" th:each="h: ${historico}">
								<div
									th:class="${(h.tipo == 'Nova consulta' ? 'historico-nova-consulta ' : '') + 
							(h.tipo == 'Nova consulta' ? 'historico-nova-consulta ' : '') + 
							(h.tipo == 'Dados' ? 'historico-novo' : '') +
							(h.tipo == 'Mudar dados' ? 'historico-editado' : '') +
							(h.tipo == 'Alteração de consulta' ? 'historico-editado-consulta' : '') +
							(h.tipo == 'Nova internação' ? 'nova-internacao' : '') +
							(h.tipo == 'Alteração de internação' ? 'edit-internacao' : '') +
							(h.tipo == 'Nova aplicacao' ? 'nova-aplicacao' : '') + 
							(h.tipo == 'Edicao de aplicacao' ? 'edit-aplicacao' : '')}">
									<div class="generico">
										<p>
											<span id="quebra"
												th:utext="${#strings.replace(h.descricao, ';' , '<br>')}"></span>
										</p>
										<p>
											<span th:text="'Tipo: ' + ${h.tipo}"></span>
										</p>
										<p>
											<span th:text="'Usuario: ' + ${h.usuario}"></span>
										</p>
										<p>
											<span
												th:text="'No dia : ' + ${#temporals.format(h.data, 'dd/MM/yyyy')} + ' às: ' + ${#temporals.format(h.hora, 'HH:mm')}"></span>
										</p>
									</div>

								</div>
							</div>
						</div>
					</section>
					<section id="section-flip-2">

						<div class="container">

							<div class="row">
								<div class="col-md-12">


									<h2>Consultas Cadastradas</h2>

									<table id="table-consultas"
										class="table table-sm table-striped nowrap"
										style="width: 100%">
										<thead class="thead-dark">
											<tr>
												<th scope="col">Paciente</th>
												<th scope="col">Data</th>
												<th scope="col">Término</th>
												<th scope="col">Editar</th>
												<th scope="col">Excluir</th>
												<th scope="col">Visualizar</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
						<a class="btn-cadastrar-usuario" id="cadastrar-consulta"
							data-toggle="modal" data-target="#modal-consulta-paciente"
							href="#" role="button">Nova Consulta</a> <a
							class="btn btn-danger"
							th:href="@{/pacientes/download/consultas/paciente/{id} (id=${animal.id})}"
							role="button"><i class="fas fa-download"></i></a>


					</section>
					<section id="section-flip-3">
						<div class="container">

							<div class="row">
								<div class="col-md-12">


									<h2>Internações Cadastradas</h2>

									<table id="table-internacoes"
										class="table table-sm table-striped nowrap"
										style="width: 100%">
										<thead class="thead-dark">
											<tr>
												<th scope="col">Status</th>
												<th scope="col">Paciente</th>
												<th scope="col">Data de Entrada</th>
												<th scope="col">Data de Saída</th>
												<th scope="col">Editar</th>
												<th scope="col">Excluir</th>
												<th scope="col">Visualizar</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
							<a class="btn-cadastrar-usuario" id="cadastrar-internacao"
								data-toggle="modal" data-target="#modal-internacao-paciente"
								href="#" role="button">Nova Internação</a>
						</div>

					</section>
					<section id="section-flip-4">
						<div class="container">

							<div class="row">
								<div class="col-md-12">
									<h2>Aplicações Cadastradas</h2>

									<table id="table-aplicacoes"
										class="table table-sm table-striped nowrap"
										style="width: 100%">
										<thead class="thead-dark">
											<tr>
												<th scope="col">Descrição</th>
												<th scope="col">Doses</th>
												<th scope="col">Data da Aplicação</th>
												<th scope="col">Próxima Aplicação</th>
												<th scope="col">Editar</th>
												<th scope="col">Excluir</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
							<a class="btn-cadastrar-usuario" id="cadastrar-aplicacao"
								data-toggle="modal" data-target="#modal-aplicacao" href="#"
								role="button">Nova Aplicação</a> <a class="btn btn-danger"
								th:href="@{/pacientes/download/imunizacoes/paciente/{id} (id=${animal.id})}"
								role="button"><i class="fas fa-download"></i></a>
						</div>
					</section>


					<span th:replace="aplicacao/modal :: modal-form"></span> <span
						th:replace="internacao/modal-por-paciente :: modal-internacao-paciente"></span>
					<span
						th:replace="consulta/modal-consulta-paciente :: modal-consulta-paciente"></span>


				</div>
				<!-- /content -->
			</div>
			<!-- /tabs -->
		</section>
	</section>
	<script th:src="@{/js/animal.js(v=${version})}" th:fragment="js"></script>

	<script th:inline="javascript" th:fragment="inlinescript">
			$('#quebra').val().replace(/\n\r?/g, '<br />');
			var idAnimal = [[${animal.id != null ? animal.id : 0}]];
			var id= [[${animal.id}]];
			var nome = [[${animal.nome}]];
			var aplicacao = [[${aplicacao.id}]];
			var internacao = [[${internacao.id}]];
			var consulta = [[${consulta.id}]];
			$(document).ready(function () {
				moment.locale('pt-BR');
			    var table = $('#table-aplicacoes').DataTable({
			    	"language":{
			    		"lengthMenu": "Mostrando _MENU_ registros por páginas",
			    		"zeroRecords": "Nenhum registro encontrado",
			            "info": "Mostrando página _PAGE_ de _PAGES_",
			            "infoEmpty": " ",
			            "search": "Pesquise: ",
			            "paginate": {
			                "first":      "Primeiro",
			                "last":       "Ultimo",
			                "next":       "Próximo",
			                "previous":   "Anterior"
			            } 
			    	},
			    	
			    	searching: true,
			    	lengthMenu: [5, 10],
			        processing: true,
			        serverSide: true,
			        responsive: true,
			        ajax: {
			       
			            url: '/aplicacoes/datatables/server/ '+idAnimal+'',
			            data: 'data',
			            vacina: 'vacina', 
			           
			        
			        },
			        columns: [
			            {data: 'vacina.descricao'},
			            {data:'doses', render: function(data, type, row){
			            	if(row.doses == 0){
			            		return 'Anual';
			            	}
			            	return row.doses + ' de ' + row.vacina.doses;
			            	
			            }},
			            {data: 'dataAplicacao', render:
			                function( data ) {
			                    return moment(data).format('L');
			                }
			            },
			            {data: 'proximaAplicacao', render:
			                function( data ) {
			                    return moment(data).format('L');
			                }
			            },
			            {orderable: false, 
			             data: 'id',
			                "render": function(id) {
			              		
			                    return '<a class="btn btn-success btn-sm btn-block" id ="btn-editar" href="/aplicacoes/editar/'+ 
			                    	id +'/paciente/'+idAnimal +'" role="button" ><i class="fas fa-edit"></i></a>';
			                }
			            },
			            {orderable: false,
			             data: 'id',
			                "render": function(id) {
			                    return '<a class="btn btn-danger btn-sm btn-block" href="/aplicacoes/excluir/'+ 
			                    	id +'/paciente/'+idAnimal +'" role="button" data-toggle="modal" data-target="#confirm-modal"><i class="fas fa-times-circle"></i></a>';
			                }               
			            },
			    
			        ]
			    });
			   
		$("#cadastrar-aplicacao").on('click', function(){	  		
			$("#datePickerId").val("");
			$("#vacina").val("");	  		 
			$('#idAplicacao').val(null);           
			$(".modal-title").text("Nova Aplicação"); 
			$(".invalid-feedback span").html("");
			$("input, select").removeClass("is-invalid");
			$(".is-invalid").removeClass("is-invalid").removeAttr('style');
			$(".msg-erro").hide();
			
		});
		$("#cadastrar-internacao").on('click', function(){	  		
			$("#animal").val(nome);
			$("#animal").attr('readonly', 'readonly');	
			$("#status").val("");	
			$("#dataEntrada").val("");	
			$("#inicio").val("");
			$("#descricao").val("");
			$("#prescricao").val("");
			$('#idInternacao').val(null);           
			$(".modal-title").text("Nova Internacao"); 
			$(".invalid-feedback span").html("");
			$("input, select").removeClass("is-invalid");
			$(".is-invalid").removeClass("is-invalid").removeAttr('style');
			$(".msg-erro").hide();
			
			
		});
		$("#cadastrar-consulta").on('click', function(){	  		
			$("#animalConsulta").val(nome);
			$("#animalConsulta").attr('readonly', 'readonly');		
			$("#datePickerIdConsulta").val("");	
			$("#inicioConsulta").val("");
			$("#terminoConsulta").val("");
			$("#descricaoConsulta").val("");
			$("#prescricaoConsulta").val("");
			$("#temperaturaConsulta").val("");
			$("#pesoConsulta").val("");
			$('#idConsulta').val(null);           
			$(".modal-title").text("Nova Consulta"); 
			$(".invalid-feedback span").html("");
			$("input, select").removeClass("is-invalid");
			$(".is-invalid").removeClass("is-invalid").removeAttr('style');
			$(".msg-erro").hide();
			
			
		});
			if(aplicacao !=null ){
				
				$("#modal-aplicacao").modal('show');
	    		$(".modal-title").text("Editar Aplicação");
	    		$("#animalConsulta").attr('readonly', 'readonly');		
			}
			if(internacao !=null){
				   $(".modal-title").text("Editar Internação");
			    	$("#modal-internacao-paciente").modal('show');
			    	$("#animal").attr('readonly', 'readonly');		
			}
			 var temperat = [[${consulta.temperatura}]];
				var pes = [[${consulta.peso}]];
			if(consulta !=null){
			
				var teste = parseFloat($("#temperatura").val());
				var peso = parseFloat($("#peso").val());
				$(".modal-title").text("Editar Consulta");
	 	    	$("#modal-consulta-paciente").modal('show');
	 	    	$("#animalConsulta").attr('readonly', 'readonly');
	 	    	if(teste != temperat){
					var t =temperat.toString().replace('.', ',');
					$("#temperatura").val(t);
				}
				if(peso != pes){
					var p =pes.toString().replace('.', ',');
					$("#peso").val(p);
				}
			}

        if($("#modal-internacao-paciente .invalid-feedback span").html() != null){
        	$("#modal-internacao-paciente").modal('show');	
        	if(internacao != null){
        		$(".modal-title").text("Editar Internacao");   
        	}else{
        		$(".modal-title").text("Nova Internacao");   
        	}
        	
        }
        if($("#modal-aplicacao .invalid-feedback span").html() != null){
        	$("#modal-aplicacao").modal('show');
        	if(aplicacao != null){
        		$(".modal-title").text("Editar Aplicacao");  
        	}else{
        		$(".modal-title").text("Nova Aplicacao");   
        	}
        	
        }
        if($("#modal-consulta-paciente .invalid-feedback span").html() != null){
        	$("#modal-consulta-paciente").modal('show');
        	if(consulta != null){
        		$(".modal-title").text("Editar Consulta");  
        	}else{
        		$(".modal-title").text("Nova Consulta");   
        	}
        	
        }   	 	
        if ($(".msg-erro").html() != "") {
        	$(".invalid-feedback span").css("color", "red");
		} 	
			    
			  			
			}); 
			
			
			
			$(document).ready(function () {
			
				moment.locale('pt-BR');
			    var table = $('#table-internacoes').DataTable({
			    	searching: true,
			 
			    	lengthMenu: [5, 10],
			        processing: true,
			        serverSide: true,
			        responsive: true,
			        ajax: {
			            url: '/internacoes/datatables/server/' +idAnimal+'',
			            data: 'data'
			          
			      
	                	
			        },
			        columns: [
			        	{data: 'status', render :
			        		function(data, type, row){
			        		if(row.status == "Ativa"){
			        			return '<strong class = "ativa">'+ row.status +'</strong>';
			        		}else{
			        			return '<strong class = "encerrada">'+ row.status +'</strong>';
			        		}
			        	}
			        },
			            {data: 'animal.nome'},
			            {data: 'dataEntrada', render:
			                function( data ) {
			                    return moment(data).format('L');
			                }
			            },
			            {data: 'dataSaida', render:
			                function( data, type, row ) {
			            		if(row.dataSaida == null){
			            			return "Internação em andamento"
			            		}
			                    return moment(data).format('L');
			                }
			            },
			            {orderable: false, 
			             data: 'id',
			                "render": function(id) {
			                		
			                		return '<a class="btn btn-success btn-sm btn-block" id ="btn_edt" href="/internacoes/editar/'+ 
			                    	id +'/paciente/'+idAnimal+'" role="button"><i class="fas fa-edit"></i></a>';
			                	
			                    
			                }
			            },
			            {orderable: false,
			             data: 'id',
			                "render": function(id) {
			                    return '<a class="btn btn-danger btn-sm btn-block" href="/internacoes/excluir/'+ 
			                    	id +'/paciente/'+idAnimal+'" role="button" data-toggle="modal" data-target="#confirm-modal"><i class="fas fa-times-circle"></i></a>';
			                }               
			            },
			            {orderable: false,
			                data: 'id',
			                   "render": function(id) {
			                	   return '<a class="btn btn-success btn-sm btn-block" href="/internacoes/visualizar/'+ 
			                   	id +'" role="button"><i class="fas fa-eye"></i></a>';
			                   }               
			               }
			        ]
			    });
			   
			    
			});    
			$(document).ready(function () {
				moment.locale('pt-BR');
			    var table = $('#table-consultas').DataTable({
			    	"language":{
			    		"lengthMenu": "Mostrando _MENU_ registros por páginas",
			    		"zeroRecords": "Nenhum registro encontrado",
			            "info": "Mostrando página _PAGE_ de _PAGES_",
			            "infoEmpty": " ",
			            "search": "Pesquise: ",
			            "paginate": {
			                "first":      "Primeiro",
			                "last":       "Ultimo",
			                "next":       "Próximo",
			                "previous":   "Anterior"
			            } 
			    	},
			    	searching: true,
			    	order: [ 0, "asc" ],
			    	lengthMenu: [5, 10],
			        processing: false,
			        serverSide: true,
			        responsive: true,
			        ajax: {
			            url: '/consultas/datatables/server/' +idAnimal+'',
			            data: 'data'
			        },
			        columns: [
			        	 {data: 'animal.nome'},
			        	{data: 'data', render:
			                function( data ) {
			                    return moment(data).format('L');
			                }
			            },
			            {data: 'termino', render:
			                function( data, type, row ) {
			            		if(row.termino == null){
			            			return "Não cadastrado";
			            		}
			                    return  moment(data, 'HH:mm:ss').format('HH:mm');
			                }
			            },
			           
			            {orderable: false, 
			             data: 'id',
			                "render": function(id) {
			                    return '<a class="btn btn-success btn-sm btn-block" href="/consultas/editar/'+ 
			                    id +'/paciente/'+idAnimal+'" role="button"><i class="fas fa-edit"></i></a>';
			                }
			            },
			            {orderable: false,
			             data: 'id',
			                "render": function(id) {
			                    return '<a class="btn btn-danger btn-sm btn-block" href="/consultas/excluir/'+ 
			                    	id +'/paciente/'+idAnimal+'" role="button" data-toggle="modal" data-target="#confirm-modal"><i class="fas fa-times-circle"></i></a>';
			                }               
			            },
			            {orderable: false,
			                data: 'id',
			                   "render": function(id) {
			                       return '<a class="btn btn-danger btn-sm btn-block" href="/consultas/visualizar/'+ 
			                       	id +'" role="button"><i class="fas fa-eye"></i></a>';
			                   }               
			               }
			        ]
			    });
			});  
			$(document).ready(function(){
				$('#tipo').on('change', function(){
					$("#busca-estilo").text("");
					$('div #busca-estilo').removeAttr('class');
					var tipo = $("#tipo option:selected").val();
					if(tipo !=""){
						$(".generico").hide();
						$("#mensagem").show();
						$("#busca-estilo").show();
						$.get( "/pacientes/buscar/tipo/" + tipo + "/paciente/" + id , function( result ) {
							corpo(result);
						})
					}else{
						$(".generico").show();
						$("#busca-estilo").hide();
						$("#mensagem").hide();
					}
				
				})
				$('#data-busca').on('change', function(){
					$("#busca-estilo").text("");
					$('div #busca-estilo').removeAttr('class');
					var data = $("#data-busca").val();
					if(data !=""){
						$(".generico").hide();
						$("#mensagem").show();
						$("#busca-estilo").show();
						$.get( "/pacientes/buscar/data/" + data + "/paciente/" + id , function( result ) {
							corpo(result);
						})
					}else{
						$(".generico").show();
						$("#busca-estilo").hide();
						$("#mensagem").hide();
					}
				
				})
				$("#reset").on('click', function(){
					$('#data-busca').val("");
					$(".generico").show();
					$("#busca-estilo").hide();
					$("#mensagem").hide();
				})
			})
			function corpo(result){
				
				$.each(result, function(k,v){
					$("#mensagem").hide();
					$("#busca-estilo").append('<div class="separador">' +
					 '<p><span>'+ v.descricao +'</span></p>' +
					 '<p><span>'+ v.tipo +'</span></p>'      +
					 '<p><span>'+ v.usuario +'</span></p>'   +
					 '<p><span>'+ moment(v.data).format('DD/MM/YYYY') +' às ' +  moment(v.hora, 'HH:mm:ss').format('HH:mm') + '</span></p></div>'
					).hide().fadeIn('slow');
					switch(v.tipo){
					case 'Dados':
						$('.separador').addClass('historico-novo');
						
					break;
					case 'Mudar dados':
						$('.separador').addClass('historico-editado');
					break;
					case 'Nova consulta':
						$('.separador').addClass('historico-nova-consulta');
					break;
					case 'Alteração de consulta':
						$('.separador').addClass('historico-editado-consulta');
						
					break;
					case 'Nova internação':
						$('.separador').addClass('nova-internacao');
					break;
					case 'Alteração de internação':
						$('.separador').addClass('edit-internacao');
					break;
					case 'Nova aplicacao':
						$('.separador').addClass('nova-aplicacao');
					break;
					case 'Edicao de aplicacao':
						$('.separador').addClass('edit-aplicacao');
					break;
				
						
					}
				})
			}
		
	</script>
</body>
</html>
