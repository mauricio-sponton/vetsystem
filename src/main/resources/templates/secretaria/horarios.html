<html xmlns:layout="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<style type="text/css">
.teste span {
	color: blue
}

.mostrar {
	background-color: indigo
}

.dias {
	background-color: black;
	!
	important
}

form {
	width: 47.2%
}

.adiciona-tr {
	background: gray;
	opacity: 0.5
}
</style>
</head>
<body>
<section class="layout-content" layout:fragment="corpo">
		<div th:replace="fragments/alert :: alerta-sucesso"></div>
		<form> 
        	<div class="form-row">
				<div class="form-group col-md-4">
					<label for="veterinario">Veterinário</label> <input type="text"
					class="form-control" id="veterinario" placeholder="João..." />
				</div>
			</div>
		</form>
		<!--  <form method="post" th:action="@{/secretarias/salvar/horarios}" th:object="${formEdit}">
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th scope="col">Dia</th>
						<th scope="col">Entrada</th>
						<th scope="col">Saída</th>
						<th scope="col">Folga</th>
					</tr>
				</thead>
				<tbody>
					<tr id="tr-teste"></tr>
				</tbody>
			</table>
			<input type="submit" id="submitButton" th:value="Salvar">	
		</form>-->
		<form th:if="${form != null}"
			th:action="@{/veterinarios/salvar/horarios}" th:object="${form}"
			method="post">
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th scope="col">Dia</th>
						<th scope="col">Entrada</th>
						<th scope="col">Saída</th>
						<th scope="col">Folga</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="cargaHoraria, itemStat : *{cargas}">

						<td scope="row" th:switch="${itemStat.index}">
							<div class="dias" th:case="0">
								<span>Domingo</span>
							</div>
							<div class="dias" th:case="1">
								<span>Segunda</span>
							</div>
							<div class="dias" th:case="2">
								<span>Terça</span>
							</div>
							<div class="dias" th:case="3">
								<span>Quarta</span>
							</div>
							<div class="dias" th:case="4">
								<span>Quinta</span>
							</div>
							<div class="dias" th:case="5">
								<span>Sexta</span>
							</div>
							<div class="dias" th:case="6">
								<span>Sábado</span>
							</div>

						</td>

						<td><input class="form-control" type="time"
							th:field="*{cargas[__${itemStat.index}__].inicio}" /></td>
						<td><input class="form-control" type="time"
							th:field="*{cargas[__${itemStat.index}__].fim}" /></td>
						<td style="display: none"><input type="hidden"
							th:field="*{cargas[__${itemStat.index}__].veterinario.id}" /></td>
						<td><input type="checkbox" id="ativo" class="teste"
							th:field="*{cargas[__${itemStat.index}__].ativo}"
							th:if="${ativo == true ? 'checked=checked' : ''} " /></td>

					</tr>
				</tbody>
			</table>
			<input type="submit" id="submitButton" th:value="Salvar">
		</form>
		<div id="edit">
		
		
		
		</div>
	<!--  	<form th:if="${formEdit != null}"
			th:action="@{/veterinarios/salvar/horarios}" th:object="${formEdit}"
			method="post">
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th scope="col">Dia</th>
						<th scope="col">Entrada</th>
						<th scope="col">Saída</th>
						<th scope="col">Folga</th>

					</tr>
				</thead>
				<tbody>
					<tr th:each="cargaHoraria, itemStat : *{cargas}">

						<td scope="row" th:switch="${itemStat.index}">
							<div class="dias" th:case="0">
								<span>Domingo</span>
							</div>
							<div class="dias" th:case="1">
								<span>Segunda</span>
							</div>
							<div class="dias" th:case="2">
								<span>Terça</span>
							</div>
							<div class="dias" th:case="3">
								<span>Quarta</span>
							</div>
							<div class="dias" th:case="4">
								<span>Quinta</span>
							</div>
							<div class="dias" th:case="5">
								<span>Sexta</span>
							</div>
							<div class="dias" th:case="6">
								<span>Sábado</span>
							</div>

						</td>

						<td><input type="time" class="inicio"
							th:name="|cargas[${itemStat.index}].inicio|"
							th:value="${cargaHoraria.getInicio()}"
							th:classappend="${#fields.hasErrors('cargas[__${itemStat.index}__].inicio')} ? 'is-invalid'" />
						<div class="invalid-feedback">
								<span th:errors="*{cargas[__${itemStat.index}__].inicio}"></span>
							</div></td>
						<td><input type="time" class="fim"
							th:name="|cargas[${itemStat.index}].fim|"
							th:value="${cargaHoraria.getFim()}"
							th:classappend="${#fields.hasErrors('cargas[__${itemStat.index}__].fim')} ? 'is-invalid'" />
							<div class="invalid-feedback">
								<span th:errors="*{cargas[__${itemStat.index}__].fim}"></span>
							</div></td>
						<td style="display: none"><input type="hidden"
							th:name="|cargas[${itemStat.index}].veterinario.id|"
							th:value="${cargaHoraria.getVeterinario().getId()}" /></td>
						<td style="display: none"><input type="hidden"
							th:name="|cargas[${itemStat.index}].id|"
							th:value="${cargaHoraria.getId()}" /></td>
						<td><input type="checkbox"
							th:field="*{cargas[__${itemStat.index}__].ativo}" class="teste"
							id="ativo"
							th:if="${cargaHoraria.isAtivo() == true ? 'checked=checked' : ''} " /></td>
					</tr>
				</tbody>
			</table>
			<input type="submit" id="submitButton" th:value="Salvar">
		</form>
		-->
	</section>

	<script th:src="@{/js/secretaria.js(v=${version})}" th:fragment="js"></script>
	<script th:inline="javascript" th:fragment="inlinescript">
	$(document).ready(function() {
		$(function(){
			
			 $('.teste').each(function() {
				if($(this).is(":checked")){
					$(this).closest('tr').find('.inicio, .fim').attr("readonly", "readonly");
					$(this).closest('tr').addClass("adiciona-tr");
				}
			 $('.teste').on('change', function(){
					
				if($(this).is(":checked")){
					$(this).closest('tr').find('.inicio, .fim').attr("readonly", "readonly");
					$(this).closest('tr').addClass("adiciona-tr");
				}else{
					if($(this).not(":checked")){
						
						$(this).closest('tr').find('.inicio, .fim').val();
						$(this).closest('tr').removeClass("adiciona-tr");
						$(this).closest('tr').find('.inicio, .fim').removeAttr("readonly");
					}
				}
			 })
			 })
			
		});
		$("#veterinario").autocomplete({
			source: function (request, response) {
				$.ajax({
					method: "GET",
					url: "/veterinarios/nome",
					data: {
						termo: request.term
					},
					success: function(data){
						response(data);
						
					}
				})
			}
		})
		$("#veterinario").on('focus', function(){

		})
		$('#veterinario').on('blur', function() {
			/*<![CDATA[*/
			var titulo = $('#veterinario').val();
			if ( titulo != '' ) {
				$.get( "/veterinarios/nome/" + titulo , function( result ) {
					$.get("/veterinarios/horarios/" + result.id, function(horarios){
						/*$.each(horarios, function (k, v){
							$("#tr-teste").append(
								'<td scope="row"><span class="dias">' +v.diaDaSemana+'</span></td>' +
								'<td><input type="time" value="'+ v.inicio +'"></td>' +
								'<td><input type="time" value="'+ v.fim +'"></td>'+
								'<td><input type="checkbox" class="teste" value="'+ v.ativo +'"></td>' +
								'<td><input type="hidden" value="'+ v.id +'"></td>'
								
							)			
						})*/
						$("#edit").append(
								'<form th:if="${formEdit != null}" th:action="@{/veterinarios/salvar/horarios}" th:object="${formEdit}" method="post">'+
									'<table class="table">'+
										'<thead class="thead-dark">' +
											'<tr>' +
												'<th scope="col">Dia</th>' +
												'<th scope="col">Entrada</th>' +
												'<th scope="col">Saída</th>' +
												'<th scope="col">Folga</th>' +

											'</tr>' +
										'</thead>' +
										'<tbody>' +	
											'<tr th:each="cargaHoraria, itemStat : *{cargas}">' +
											'<td><input type="time" class="inicio"'+
												'th:name="|cargas[${itemStat.index}].inicio|"'+
												'th:value="${cargaHoraria.getInicio()}"'+
												'th:classappend="${#fields.hasErrors(' +'cargas[__${itemStat.index}__].inicio'+')} ? ' +'is-invalid' +'" />'+
											'</tr>'+
										'</tbody>'+
									'</table>'
						
						);
						
					})
					
				})
			}
			/*]]>*/ 
		})
	});
	
	</script>
</body>
</html>